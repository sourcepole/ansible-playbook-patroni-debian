# ATTENTION DANGER: this playbook will destroy everything,
#                   even potential database data - everything!
#                   Akira style!
#
- name: will purge patroni, etcd, postgres, vip-manager
  hosts:
    - dcs_servers
    - pgsql_servers
  vars_files:
    - vars.yml
  tasks:
    - apt:
        pkg:
          - etcd-server
          - patroni
          - vip-manager
          - postgresql-common
          - "postgresql-{{ postgresql_major_version }}"
          - "postgresql-contrib-{{ postgresql_major_version }}"
          - "postgresql-client-{{ postgresql_major_version }}"
        state: absent
        purge: yes
    - command: pkill -TERM patroni
      ignore_errors: true
    - file:
        path:
          - /etc/patroni
          - /etc/postgresql
          - /etc/postgresql-common
          - /var/lib/postgresql/{{ postgresql_major_version }}
        state: absent
